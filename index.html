<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Recipe Builder</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css">
  <style>
    @media print {
      .no-print { display: none !important; }
      body { background: white; }
    }
    .hidden { display: none; }
  </style>
</head>
<body class="bg-gray-100 p-6">
  <div class="max-w-6xl mx-auto">
    <h1 class="text-3xl font-bold text-orange-600 mb-6">Recipe Builder</h1>

    <!-- Recipe Form -->
    <div class="bg-white rounded-lg shadow p-6 mb-6">
      <h2 class="text-xl font-semibold mb-4">Recipe Details</h2>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">Name</label>
          <input id="recipeName" type="text" placeholder="Recipe Name" class="w-full p-2 border border-gray-300 rounded focus:ring-2 focus:ring-orange-500 focus:border-transparent">
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">Description</label>
          <textarea id="description" rows="2" placeholder="Recipe Description" class="w-full p-2 border border-gray-300 rounded focus:ring-2 focus:ring-orange-500 focus:border-transparent"></textarea>
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">Servings</label>
          <input id="servings" type="number" class="w-full p-2 border border-gray-300 rounded focus:ring-2 focus:ring-orange-500 focus:border-transparent" value="4">
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">Prep Time (min)</label>
          <input id="prepTime" type="number" class="w-full p-2 border border-gray-300 rounded focus:ring-2 focus:ring-orange-500 focus:border-transparent" value="15">
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">Cook Time (min)</label>
          <input id="cookTime" type="number" class="w-full p-2 border border-gray-300 rounded focus:ring-2 focus:ring-orange-500 focus:border-transparent" value="30">
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">Tags</label>
          <div class="flex gap-2">
            <input id="tagInput" type="text" placeholder="Add a tag" class="flex-1 p-2 border border-gray-300 rounded focus:ring-2 focus:ring-orange-500 focus:border-transparent">
            <button id="addTagBtn" class="bg-orange-500 hover:bg-orange-600 text-white px-4 py-2 rounded">Add</button>
          </div>
          <div id="tagsContainer" class="flex flex-wrap gap-2 mt-2"></div>
        </div>
      </div>
    </div>

    <!-- Ingredients -->
    <div class="bg-white rounded-lg shadow p-6 mb-6">
      <div class="flex justify-between items-center mb-4">
        <h2 class="text-xl font-semibold">Ingredients</h2>
        <button id="addIngredientBtn" class="bg-orange-500 hover:bg-orange-600 text-white px-4 py-2 rounded">Add Ingredient</button>
      </div>
      <div id="ingredientsList"></div>
    </div>

    <!-- Instructions -->
    <div class="bg-white rounded-lg shadow p-6 mb-6">
      <div class="flex justify-between items-center mb-4">
        <h2 class="text-xl font-semibold">Instructions</h2>
        <button id="addInstructionBtn" class="bg-orange-500 hover:bg-orange-600 text-white px-4 py-2 rounded">Add Instruction</button>
      </div>
      <div id="instructionsList"></div>
    </div>

    <!-- Scaling -->
    <div class="bg-white rounded-lg shadow p-6 mb-6">
      <h2 class="text-xl font-semibold mb-4">Scale Recipe</h2>
      <div class="flex items-center gap-4">
        <button id="decreaseScale" class="bg-gray-200 hover:bg-gray-300 text-gray-800 px-4 py-2 rounded">-</button>
        <span id="scaleDisplay" class="font-medium">1.00x</span>
        <button id="increaseScale" class="bg-gray-200 hover:bg-gray-300 text-gray-800 px-4 py-2 rounded">+</button>
        <span id="scaledServings" class="ml-4">4 servings</span>
      </div>
    </div>

    <!-- Summary -->
    <div id="recipeSummary" class="bg-white rounded-lg shadow p-6 mb-6 hidden">
      <div class="flex justify-between items-center mb-4">
        <h2 class="text-xl font-semibold">Recipe Summary</h2>
        <button id="printBtn" class="bg-orange-500 hover:bg-orange-600 text-white px-4 py-2 rounded no-print">Print</button>
      </div>
      <h3 id="summaryTitle" class="text-2xl font-bold mb-2"></h3>
      <div id="summaryDescription" class="mb-4"></div>
      <div id="summaryTags" class="mb-4 hidden">
        <h4 class="text-lg font-semibold mb-2">Tags</h4>
        <div id="summaryTagsList" class="flex flex-wrap gap-1"></div>
      </div>
      <div id="summaryServings" class="mb-2"></div>
      <div id="summaryTime" class="mb-4"></div>
      <div id="summaryIngredients" class="mb-4 hidden">
        <h4 class="text-lg font-semibold mb-2">Ingredients</h4>
        <ul id="summaryIngredientsList" class="list-disc pl-5"></ul>
      </div>
      <div id="summaryInstructions" class="hidden">
        <h4 class="text-lg font-semibold mb-2">Instructions</h4>
        <ol id="summaryInstructionsList" class="list-decimal pl-5"></ol>
      </div>
    </div>
  </div>

  <script>
    // Global state
    let recipe = {
      name: '',
      description: '',
      servings: 4,
      prepTime: 15,
      cookTime: 30,
      ingredients: [],
      instructions: [''],
      tags: []
    };
    let scaleFactor = 1;
    let ingredientCounter = 0;

    const units = ['cups', 'tablespoons', 'teaspoons', 'ounces', 'pounds', 'grams', 'kilograms', 'milliliters', 'liters', 'pieces', 'cloves'];

    // Debounce helper
    function debounce(func, delay) {
      let timeout;
      return function() {
        const context = this;
        const args = arguments;
        clearTimeout(timeout);
        timeout = setTimeout(() => func.apply(context, args), delay);
      };
    }

    // Initialize
    document.addEventListener('DOMContentLoaded', function() {
      addInitialIngredients();
      addInitialInstruction();
      setupEventListeners();
      // Event delegation for ingredient removal
      document.getElementById('ingredientsList').addEventListener('click', function(e) {
        const btn = e.target.closest('button[data-id]');
        if (btn) {
          const id = parseInt(btn.getAttribute('data-id'));
          removeIngredient(id);
        }
      });
      // Event delegation for instruction removal
      document.getElementById('instructionsList').addEventListener('click', function(e) {
        const btn = e.target.closest('button[data-index]');
        if (btn) {
          const index = parseInt(btn.getAttribute('data-index'));
          removeInstruction(index);
        }
      });
    });

    function setupEventListeners() {
      // Recipe name
      document.getElementById('recipeName').addEventListener('input', debounce(function(e) {
        recipe.name = e.target.value;
        updateSummary();
      }, 300));

      // Servings, prep, cook time
      document.getElementById('servings').addEventListener('input', debounce(function(e) {
        recipe.servings = parseInt(e.target.value) || 0;
        updateSummary();
      }, 300));

      document.getElementById('prepTime').addEventListener('input', debounce(function(e) {
        recipe.prepTime = parseInt(e.target.value) || 0;
        updateSummary();
      }, 300));

      document.getElementById('cookTime').addEventListener('input', debounce(function(e) {
        recipe.cookTime = parseInt(e.target.value) || 0;
        updateSummary();
      }, 300));

      // Description
      document.getElementById('description').addEventListener('input', debounce(function(e) {
        recipe.description = e.target.value;
        updateSummary();
      }, 300));

      // Tags
      document.getElementById('addTagBtn').addEventListener('click', addTag);
      document.getElementById('tagInput').addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
          addTag();
          e.preventDefault();
        }
      });

      // Scaling
      document.getElementById('decreaseScale').addEventListener('click', function() {
        scaleFactor = Math.max(0.25, scaleFactor - 0.25);
        updateScaleDisplay();
      });
      document.getElementById('increaseScale').addEventListener('click', function() {
        scaleFactor += 0.25;
        updateScaleDisplay();
      });

      // Ingredients and Instructions
      document.getElementById('addIngredientBtn').addEventListener('click', addIngredient);
      document.getElementById('addInstructionBtn').addEventListener('click', addInstruction);

      // Print
      document.getElementById('printBtn').addEventListener('click', function() {
        window.print();
      });
    }

    function addInitialIngredients() {
      for (let i = 0; i < 3; i++) {
        addIngredient();
      }
    }

    function addInitialInstruction() {
      addInstruction();
    }

    function addTag() {
      const input = document.getElementById('tagInput');
      const tag = input.value.trim();
      if (tag && !recipe.tags.includes(tag)) {
        recipe.tags.push(tag);
        input.value = '';
        updateTagsDisplay();
        updateSummary();
      }
    }

    function removeTag(tag) {
      recipe.tags = recipe.tags.filter(t => t !== tag);
      updateTagsDisplay();
      updateSummary();
    }

    function updateTagsDisplay() {
      const container = document.getElementById('tagsContainer');
      container.innerHTML = recipe.tags.map(tag => `
        <span class="flex items-center bg-orange-100 text-orange-800 text-sm px-3 py-1 rounded-full">
          ${tag}
          <button onclick="removeTag('${tag}')" class="ml-2 text-orange-600 hover:text-orange-900">×</button>
        </span>
      `).join('');
    }

    function addIngredient() {
      ingredientCounter++;
      const ingredient = {
        id: ingredientCounter,
        name: '',
        amount: '',
        preparation: '',
        unit: 'cups'
      };
      recipe.ingredients.push(ingredient);

      const container = document.getElementById('ingredientsList');
      const ingredientDiv = document.createElement('div');
      ingredientDiv.className = 'grid grid-cols-12 gap-3 p-3 bg-white border border-gray-200 rounded-lg items-start mb-3';
      ingredientDiv.id = `ingredient-${ingredient.id}`;

      ingredientDiv.innerHTML = `
        <div class="col-span-4">
          <input type="text" placeholder="Enter ingredient..."
                 class="w-full p-2 border border-gray-300 rounded focus:ring-2 focus:ring-orange-500 focus:border-transparent"
                 onchange="updateIngredient(${ingredient.id}, 'name', this.value)">
        </div>
        <div class="col-span-2">
          <input type="number" step="0.01" placeholder="0"
                 class="w-full p-2 border border-gray-300 rounded focus:ring-2 focus:ring-orange-500 focus:border-transparent"
                 onchange="updateIngredient(${ingredient.id}, 'amount', this.value)">
          <div class="text-xs text-gray-500 mt-1 scaled-amount" style="display: none;">
            Scaled: <strong></strong>
          </div>
        </div>
        <div class="col-span-3">
          <input type="text" placeholder="diced, chopped, etc."
                 class="w-full p-2 border border-gray-300 rounded focus:ring-2 focus:ring-orange-500 focus:border-transparent"
                 onchange="updateIngredient(${ingredient.id}, 'preparation', this.value)">
        </div>
        <div class="col-span-2">
          <select class="w-full p-2 border border-gray-300 rounded focus:ring-2 focus:ring-orange-500 focus:border-transparent"
                  onchange="updateIngredient(${ingredient.id}, 'unit', this.value)">
            ${units.map(unit => `<option value="${unit}">${unit}</option>`).join('')}
          </select>
        </div>
        <div class="col-span-1">
          <button data-id="${ingredient.id}" class="text-red-500 hover:text-red-700 text-xs flex items-center gap-1 justify-center">
            × Remove
          </button>
        </div>
      `;
      container.appendChild(ingredientDiv);
    }

    function removeIngredient(id) {
      recipe.ingredients = recipe.ingredients.filter(ing => ing.id !== id);
      document.getElementById(`ingredient-${id}`)?.remove();
      updateSummary();
    }

    function updateIngredient(id, field, value) {
      const ingredient = recipe.ingredients.find(ing => ing.id === id);
      if (ingredient) {
        ingredient[field] = value;
        if (field === 'amount' && value) {
          const scaledAmountDiv = document.querySelector(`#ingredient-${id} .scaled-amount`);
          const scaledValue = parseFloat(value) * scaleFactor;
          scaledAmountDiv.querySelector('strong').textContent = parseFloat(scaledValue.toFixed(2));
          scaledAmountDiv.style.display = 'block';
        } else if (field === 'amount' && !value) {
          const scaledAmountDiv = document.querySelector(`#ingredient-${id} .scaled-amount`);
          scaledAmountDiv.style.display = 'none';
        }
        updateSummary();
      }
    }

    function addInstruction() {
      const index = recipe.instructions.length;
      recipe.instructions.push('');

      const container = document.getElementById('instructionsList');
      const instructionDiv = document.createElement('div');
      instructionDiv.className = 'flex gap-3 items-start mb-3';
      instructionDiv.id = `instruction-${index}`;

      instructionDiv.innerHTML = `
        <div class="flex-shrink-0 w-8 h-8 bg-orange-500 text-white rounded-full flex items-center justify-center text-sm font-medium">
          ${index + 1}
        </div>
        <div class="flex-1 flex gap-2">
          <textarea rows="2" placeholder="Enter instruction step..."
                    class="flex-1 p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent"
                    onchange="updateInstruction(${index}, this.value)"></textarea>
          ${recipe.instructions.length > 1 ? 
            `<button data-index="${index}" class="text-red-500 hover:text-red-700 p-1">×</button>` : 
            ''
          }
        </div>
      `;
      container.appendChild(instructionDiv);
    }

    function removeInstruction(index) {
      if (recipe.instructions.length > 1) {
        recipe.instructions.splice(index, 1);
        document.getElementById(`instruction-${index}`)?.remove();
        // Update numbering for remaining instructions
        const container = document.getElementById('instructionsList');
        const instructions = container.children;
        for (let i = 0; i < instructions.length; i++) {
          const numberDiv = instructions[i].querySelector('.w-8');
          numberDiv.textContent = i + 1;
          instructions[i].id = `instruction-${i}`;
        }
        updateSummary();
      }
    }

    function updateInstruction(index, value) {
      recipe.instructions[index] = value;
      updateSummary();
    }

    function updateScaleDisplay() {
      document.getElementById('scaleDisplay').textContent = scaleFactor.toFixed(2) + 'x';
      document.getElementById('scaledServings').innerHTML = `<strong>${Math.round(recipe.servings * scaleFactor)}</strong> servings`;
      recipe.ingredients.forEach(ing => {
        if (ing.amount) {
          const scaledAmountDiv = document.querySelector(`#ingredient-${ing.id} .scaled-amount`);
          if (scaledAmountDiv) {
            const scaledValue = parseFloat(ing.amount) * scaleFactor;
            scaledAmountDiv.querySelector('strong').textContent = parseFloat(scaledValue.toFixed(2));
          }
        }
      });
      updateSummary();
    }

    function updateSummary() {
      const summary = document.getElementById('recipeSummary');
      const printBtn = document.getElementById('printBtn');
      if (recipe.name) {
        summary.classList.remove('hidden');
        printBtn.classList.remove('hidden');
        document.getElementById('summaryTitle').textContent = recipe.name;
        const descDiv = document.getElementById('summaryDescription');
        descDiv.textContent = recipe.description;
        descDiv.classList.toggle('hidden', !recipe.description);
        const tagsDiv = document.getElementById('summaryTags');
        if (recipe.tags.length > 0) {
          document.getElementById('summaryTagsList').innerHTML = recipe.tags.map(tag => 
            `<span class="inline-block bg-orange-200 text-orange-800 text-xs px-2 py-1 rounded-full mr-1 mb-1">${tag}</span>`
          ).join('');
          tagsDiv.classList.remove('hidden');
        } else {
          tagsDiv.classList.add('hidden');
        }
        document.getElementById('summaryServings').innerHTML = `<strong>${Math.round(recipe.servings * scaleFactor)}</strong> servings`;
        document.getElementById('summaryTime').innerHTML = `<strong>${recipe.prepTime + recipe.cookTime}</strong> min total`;
        const validIngredients = recipe.ingredients.filter(ing => ing.name && ing.amount);
        const ingredientsDiv = document.getElementById('summaryIngredients');
        if (validIngredients.length > 0) {
          document.getElementById('summaryIngredientsList').innerHTML = validIngredients.map(ing => {
            const scaledAmount = parseFloat(ing.amount) * scaleFactor;
            return `<li><strong>${parseFloat(scaledAmount.toFixed(2))}</strong> ${ing.unit} <strong>${ing.name}</strong> ${ing.preparation ? `(${ing.preparation})` : ''}</li>`;
          }).join('');
          ingredientsDiv.classList.remove('hidden');
        } else {
          ingredientsDiv.classList.add('hidden');
        }
        const validInstructions = recipe.instructions.filter(inst => inst.trim() !== '');
        const instructionsDiv = document.getElementById('summaryInstructions');
        if (validInstructions.length > 0) {
          document.getElementById('summaryInstructionsList').innerHTML = validInstructions.map(inst => `<li>${inst}</li>`).join('');
          instructionsDiv.classList.remove('hidden');
        } else {
          instructionsDiv.classList.add('hidden');
        }
      } else {
        summary.classList.add('hidden');
        printBtn.classList.add('hidden');
      }
    }
  </script>
</body>
</html>
